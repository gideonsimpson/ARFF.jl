<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Training with Resampling · ARFF.jl</title><meta name="title" content="Training with Resampling · ARFF.jl"/><meta property="og:title" content="Training with Resampling · ARFF.jl"/><meta property="twitter:title" content="Training with Resampling · ARFF.jl"/><meta name="description" content="Documentation for ARFF.jl."/><meta property="og:description" content="Documentation for ARFF.jl."/><meta property="twitter:description" content="Documentation for ARFF.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ARFF.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Structures</span><ul><li><a class="tocitem" href="../../structs/data/">Data Sets</a></li><li><a class="tocitem" href="../../structs/activation/">Activation Functions</a></li><li><a class="tocitem" href="../../structs/fourier/">Fourier Feature Models</a></li></ul></li><li><span class="tocitem">Resampling</span><ul><li><a class="tocitem" href="../../resample/resample/">Resampling</a></li></ul></li><li><span class="tocitem">Training</span><ul><li><a class="tocitem" href="../../train/general/">General Training</a></li><li><a class="tocitem" href="../../train/rwm/">Random Walk Metropolis Training</a></li></ul></li><li><a class="tocitem" href="../../aux/">Auxiliary Functions and Utilities</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example1/">Scalar Example</a></li><li><a class="tocitem" href="../example2/">Scalar Example with Generalized Activation Functions</a></li><li><a class="tocitem" href="../example3/">Example with Generalized Activation Functions and Scalings</a></li><li class="is-active"><a class="tocitem" href>Training with Resampling</a><ul class="internal"><li><a class="tocitem" href="#Define-Function"><span>Define Function</span></a></li><li><a class="tocitem" href="#Generate-data"><span>Generate data</span></a></li><li><a class="tocitem" href="#Define-Training-Parameters"><span>Define Training Parameters</span></a></li><li><a class="tocitem" href="#Define-solver-and-resampler-for-each-R-value"><span>Define solver and resampler for each R value</span></a></li><li><a class="tocitem" href="#Train-and-Evaluate-Results"><span>Train and Evaluate Results</span></a></li></ul></li><li><a class="tocitem" href="../vector1/">Vector Valued Example</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Training with Resampling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Training with Resampling</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/gideonsimpson/ARFF.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/gideonsimpson/ARFF.jl/blob/main/docs/src/examples/example4.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Training-with-Resampling"><a class="docs-heading-anchor" href="#Training-with-Resampling">Training with Resampling</a><a id="Training-with-Resampling-1"></a><a class="docs-heading-anchor-permalink" href="#Training-with-Resampling" title="Permalink"></a></h1><p>To illustrate the use of resampling, we follow an example from Section 3 of  [<a href="../../#kammonen_adaptive_2024">2</a>].  We will fit data generated by the following function <span>$f: \mathbb{R}^d \to \mathbb{R}$</span>:</p><p class="math-container">\[\begin{align*}
    \boldsymbol{x}_m &amp;\sim \mathcal{N}(\boldsymbol{0}, Id), \\
    y_m &amp;= f(\boldsymbol{x}_m), \\
    f(\boldsymbol{x}) &amp;= \mathrm{Si}\left(\frac{[\boldsymbol{x}B]_1}{a}\right)\exp\left(-\frac{||\boldsymbol{x}B||_2^2}{2}\right),
\end{align*}\]</p><p>for row vector <span>$\boldsymbol{x}_m \in \mathbb{R}^{1 \times d}$</span> and where <span>$[\boldsymbol{x}B]_1$</span> denotes the first component of the vector <span>$\boldsymbol{x}B$</span> with <span>$B$</span> being the rotation matrix defined as follows:</p><p class="math-container">\[B = \begin{bmatrix}
0.8617 &amp; 0.4975 &amp; -0.0998 &amp; -0.0000 \\
0.3028 &amp; -0.5246 &amp; -0.0000 &amp; 0.7957 \\
0.0865 &amp; 0.0499 &amp; 0.9950 &amp; 0.0000 \\
0.3978 &amp; -0.6891 &amp; -0.0000 &amp; -0.6057 \\
\end{bmatrix}.\]</p><p>In our example, we will use <span>$a = 10^{-2}$</span>.</p><h2 id="Define-Function"><a class="docs-heading-anchor" href="#Define-Function">Define Function</a><a id="Define-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Define-Function" title="Permalink"></a></h2><pre><code class="language-julia hljs">Bt = [  0.8617 0.4975 -0.0998 -0.0;
        0.3028 -0.5246 -0.0000 0.7957;
        0.0865 0.0499 0.9950 0.0000;
        0.3978 -0.6891 -0.0000 -0.6057];

B = (Bt&#39;)|&gt;collect;
b1 = B[1,:];

a = 1e-2;
f(x) = sinint(b1⋅x/ a) * exp(-0.5 * (norm(B*x,2)^2)); nothing;</code></pre><h2 id="Generate-data"><a class="docs-heading-anchor" href="#Generate-data">Generate data</a><a id="Generate-data-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-data" title="Permalink"></a></h2><p>Next, we generate our training data.</p><pre><code class="language-julia hljs">dx = 4;
nx = 10^4;
Random.seed!(100) # for reproducibility
x = [randn(dx) for _ in 1:nx];
y = f.(x);
data = DataSet(x, y); nothing;</code></pre><h2 id="Define-Training-Parameters"><a class="docs-heading-anchor" href="#Define-Training-Parameters">Define Training Parameters</a><a id="Define-Training-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Define-Training-Parameters" title="Permalink"></a></h2><p>We now define our model and prepare for training.  Note that this example uses <a href="../../structs/activation/#activation">sigmoid type activation functions</a>.</p><pre><code class="language-julia hljs">@show K = 2^8;
Random.seed!(200) # for reproducibility

F0 = FourierModel([1.0 for _ in 1:K], [10 * rand(dx) for _ in 1:K], SigmoidActivation)
δ = 0.1 # rwm step size
λ = 1e-1 # regularization
n_epochs = 10^3 # number of epochs
# number of rwm steps between full updates and resampling
n_rwm_steps = [5, 5, 1]
# use 10% of the run for burn in
n_burn = n_epochs ÷ 10

batch_size = 10^3; nothing;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">K = 2 ^ 8 = 256</code></pre><h2 id="Define-solver-and-resampler-for-each-R-value"><a class="docs-heading-anchor" href="#Define-solver-and-resampler-for-each-R-value">Define solver and resampler for each R value</a><a id="Define-solver-and-resampler-for-each-R-value-1"></a><a class="docs-heading-anchor-permalink" href="#Define-solver-and-resampler-for-each-R-value" title="Permalink"></a></h2><p>We now define the functions we intend to use, including a distinct resampler depending on the value of <code>R</code>:</p><pre><code class="language-julia hljs">linear_solver! = (β, ω, x, y, S, epoch) -&gt; solve_normal!(β, S, y, λ=λ) # define linear solver

rwm_sampler = [AdaptiveRWMSampler(F0, linear_solver!, n_rwm_steps_, n_burn, δ) for n_rwm_steps_ in n_rwm_steps]; #define rwm sampler for each R.

R_vals = [0.0, 0.75, 1.0] # effective sample size thresholds

mutate_rwm1!(F, x, y, S, n) = ARFF.rwm!(F, rwm_sampler[1], x, y, S, n) # mutate rwm for R=0.0
mutate_rwm2!(F, x, y, S, n) = ARFF.rwm!(F, rwm_sampler[2], x, y, S, n) # mutate rwm for R=0.75
mutate_rwm3!(F, x, y, S, n) = ARFF.rwm!(F, rwm_sampler[3], x, y, S, n) # mutate rwm for R=1.0

mutate_rwm_array = [mutate_rwm1!, mutate_rwm2!, mutate_rwm3!]

resampler! = [(F, x, y, S, epoch) -&gt; ARFF.resample!(F, x, y, S, epoch, rwm_sampler[i].linear_solve!, R=R_vals[i]) for i in 1:3] # resampler for every R value

solver = [ARFFSolver(rwm_sampler[i].linear_solve!, mutate_rwm_array[i], resampler![i], mse_loss) for i in 1:3]; # solver for every resampler
nothing;</code></pre><h2 id="Train-and-Evaluate-Results"><a class="docs-heading-anchor" href="#Train-and-Evaluate-Results">Train and Evaluate Results</a><a id="Train-and-Evaluate-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Train-and-Evaluate-Results" title="Permalink"></a></h2><h3 id="Train-R0.0-Network"><a class="docs-heading-anchor" href="#Train-R0.0-Network">Train <span>$R=0.0$</span> Network</a><a id="Train-R0.0-Network-1"></a><a class="docs-heading-anchor-permalink" href="#Train-R0.0-Network" title="Permalink"></a></h3><p>This example corresponds to pure RWM; no resampling takes place.</p><pre><code class="language-julia hljs">Random.seed!(1000) # for reproducibility
G1 = deepcopy(F0)
loss1 = train_arff!(G1,data, batch_size, solver[1], n_epochs, show_progress=false);nothing;</code></pre><h3 id="Train-R0.8-Network"><a class="docs-heading-anchor" href="#Train-R0.8-Network">Train <span>$R=0.8$</span> Network</a><a id="Train-R0.8-Network-1"></a><a class="docs-heading-anchor-permalink" href="#Train-R0.8-Network" title="Permalink"></a></h3><p>In this case, resampling takes place when the ESS falls beneath <span>$R \cdot K$</span>.</p><pre><code class="language-julia hljs">Random.seed!(1000) # for reproducibility
G2 = deepcopy(F0)
loss2 = train_arff!(G2, data, batch_size, solver[2], n_epochs, show_progress=false); nothing;</code></pre><h3 id="Train-R1.0-Network"><a class="docs-heading-anchor" href="#Train-R1.0-Network">Train <span>$R=1.0$</span> Network</a><a id="Train-R1.0-Network-1"></a><a class="docs-heading-anchor-permalink" href="#Train-R1.0-Network" title="Permalink"></a></h3><p>In this case, resampling takes place at every step.</p><pre><code class="language-julia hljs">Random.seed!(1000) # for reproducibility
G3 = deepcopy(F0)
loss3 = train_arff!(G3, data, batch_size, solver[3], n_epochs, show_progress=false); nothing;</code></pre><h3 id="Compare-Loss-Curves"><a class="docs-heading-anchor" href="#Compare-Loss-Curves">Compare Loss Curves</a><a id="Compare-Loss-Curves-1"></a><a class="docs-heading-anchor-permalink" href="#Compare-Loss-Curves" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot(1:n_epochs, loss1, xscale=:log10, yscale = :log10, label = &quot;R=0.0&quot;, legend = :bottomleft)
plot!(1:n_epochs, loss2, label = &quot;R=0.75&quot;)
plot!(1:n_epochs, loss3, label = &quot;R=1.0&quot;)
xlabel!(&quot;Epoch&quot;)
ylabel!(&quot;Loss&quot;)</code></pre><img src="ae2ad0c2.svg" alt="Example block output"/><p>The parameters can be tuned in the above example to get more accurate results. We have found resampling method improves some problems, but performs similarily to the <span>$R=0.0$</span> case in others. The performance appears to improve the most when using large data sets with large <span>$K$</span> values.  See [<a href="../../#kammonen_adaptive_2024">2</a>] for more examples.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example3/">« Example with Generalized Activation Functions and Scalings</a><a class="docs-footer-nextpage" href="../vector1/">Vector Valued Example »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 7 November 2024 23:00">Thursday 7 November 2024</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
